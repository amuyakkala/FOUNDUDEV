const chalk = require('chalk');
const { createBox } = require('./display');
const { BASE_URL } = require('../config');
const fs = require('fs');
const packageJson = require('../../package.json');


// Get version directly from package.json
const { version: PACKAGE_VERSION, name: PACKAGE_NAME } = packageJson;

const fetch = require('node-fetch');

const checkForUpdates = async () => {
  try {
    const URL = `${BASE_URL}/v1/cli/version?installed_version=${PACKAGE_VERSION}`;
    const response = await fetch(URL, {
      method: 'GET',
      headers: {
        'Content-Type': 'application/json',
      },
      timeout: 5000,
    });
    if (response.ok) {
        const data = await response.json();
        if (data.is_update_available) {
        console.log(createBox(
            `A new version of the Toolhouse CLI is available: ${chalk.bold(`${data.latest_version}`)}. Update now: ${chalk.bold(`npm up ${PACKAGE_NAME}`)}`,
            { borderColor: 'yellow' }
        ));
        }
    }
  } catch (error) {
  }
};

// Export the version for direct use
module.exports = { PACKAGE_VERSION, checkForUpdates };

